# ---------------
# Some Pre-config
# ---------------
# Start window and pane numbers at 1
set  -g base-index 1
setw -g pane-base-index 1

# renumber windows sequentially after closing any of them
set -g renumber-windows on

# Don't allow tmux to rename the window based on commands running
setw -g allow-rename off

# Act like vim
setw -g mode-keys vi

# Enable mouse mode
set -g mouse on

set -g history-limit 10000

# Helps in faster key repetition
set -sg escape-time 20

# Sleep screen (triggered after 300s)
set -g lock-after-time 300
set -g lock-command "cmatrix -s"

# Solves the problem of changing the cursor from rectangle to pipe when
# switching from Normal Mode to Insert Mode either in vim and terminal
# set -ga terminal-overrides '*:Ss=\E[%p1%d q:Se=\E[ q'

# -----------
# Keybindings
# -----------
# Remap prefix from 'C-b' to 'C-a'
unbind C-b
set -g prefix C-a
bind-key C-a send-prefix

# Alt-h and Alt-l to move between windows
unbind p
unbind n
bind -n M-h previous-window
bind -n M-l next-window

bind o last-window

# Switch between sessions
bind -r ( switch-client -p
bind -r ) switch-client -n

# Navigation between panes with 'prefix + (h, j, k and l)'
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Split panes using - and \ (pipe without pressing shift)
unbind '"'
unbind %
bind \\ split-window -h -c "#{pane_current_path}" # 'pane_current_path' doesn't follow symlinks
bind -  split-window -v -c "#{pane_current_path}"

# Resizing panes (mouse also works).
unbind C-Up
unbind C-Down
unbind C-Left
unbind C-Right
bind -nr C-Left  resize-pane -L 3
bind -nr C-Right resize-pane -R 3
bind -nr C-Down  resize-pane -D 3
bind -nr C-Up    resize-pane -U 3

unbind Up
unbind Down
unbind Left
unbind Right
bind Up   select-layout "even-horizontal"
bind Down select-layout "even-vertical"
bind =    select-layout "tiled"
bind r    rotate-window # Swap panes

bind y setw synchronize-panes

# Better Vim keybindings in copy-mode
unbind -T copy-mode-vi Space;
unbind -T copy-mode-vi Enter;
unbind v
unbind y
unbind p
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -selection clipboard"
bind p paste-buffer

# Reload config file (change file location to your the tmux.conf you want to use)
bind R source-file ~/.tmux.conf \; display ".tmux.conf sourced!"

# Pressing 'C-e' will open '$HOME/.tmux.conf' in '$EDITOR' and reload settings on quit
unbind e
bind e new-window -n ".tmux.conf" "sh -c '$EDITOR $HOME/.tmux.conf && tmux source $HOME/.tmux.conf'"

# Prefix + l to clear screen and history buffer
# bind -n C-l \
#     send-keys "C-c; clear && tmux clear-history" \; \
#     send-keys "Enter" \; \
#     display 'Screen cleared'

# --
# UI
# --
# Improve colors
set -g  default-terminal 'tmux-256color'
set -ga terminal-overrides ",*256col*:Tc"

# Pane number display in interactive mode
set -g display-panes-active-colour colour154
set -g display-panes-colour colour246

# Colors of panes borders
set -g pane-border-style fg=colour237
set -g pane-active-border-style fg=colour242

# Message info
set -g message-style bg=colour239,fg=colour154
set -g message-command-style bg=colour239,fg=colour154 # bg=fg3, fg=bg1

# Clock mode (default: prefix + t) color
setw -g clock-mode-colour colour121

# Colored 'undercurl' support
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'

# Status bar
set  -g status 'on'
set  -g status-interval 1 # Refresh status line every second (good for when music is playing, update time, etc)
set  -g status-position bottom
set  -g status-justify 'centre'
set  -g status-left-length '100'
set  -g status-right-length '100'
setw -g window-status-separator ''
set  -g status-bg 'colour235'

session_name="#[fg=colour232,bg=colour154] ❐ #S #[fg=colour154,bg=colour235,nobold,nounderscore,noitalics]"
uptime="#[fg=colour121,bg=colour235]羽Uptime: #(uptime | cut -f 4-5 -d ' ' | cut -f 1-1 -d ',') #[fg=colour235,bg=colour235,nobold,nounderscore,noitalics]"
set  -g status-left "$session_name $uptime"

datetime="#[fg=colour235,bg=colour235,nobold,nounderscore,noitalics]#[fg=colour121,bg=colour235]  %r   %a, %d %b %Y"
user_host="#[fg=colour238,bg=colour235,nobold,nounderscore,noitalics]#[fg=colour222,bg=colour238]   #(whoami)@#H"
battery_status="#[fg=colour154,bg=colour238,nobold,nounderscore,noitalics]#[fg=colour232,bg=colour154] #(rainbarf --battery --remaining --no-rgb)"
set -g status-right "$datetime $user_host $battery_status"

setw -g window-status-format '#[fg=colour235,bg=colour235,nobold,nounderscore,noitalics]#[fg=colour121,bg=colour235]#I#F  #W#[fg=colour235,bg=colour235,nobold,nounderscore,noitalics]'
setw -g window-status-current-format '#[fg=colour235,bg=colour238,nobold,nounderscore,noitalics]#[fg=colour222,bg=colour238] #I#F  #W #[fg=colour238,bg=colour235,nobold,nounderscore,noitalics]'
